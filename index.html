<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新年烟花</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: "Microsoft YaHei", sans-serif;
        }
        canvas {
            display: block;
        }
        #settingsButton {
            position: fixed;
            right: 20px;
            top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        #settingsButton:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        #settingsPanel {
            position: fixed;
            right: 20px;
            top: 70px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            color: white;
            display: none;
            z-index: 100;
        }
        #textInput {
            width: 200px;
            padding: 8px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 5px;
        }
        #applyButton {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        #applyButton:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        @media (max-width: 768px) {
            #settingsButton {
                padding: 8px 15px;
                font-size: 14px;
            }
            #settingsPanel {
                right: 10px;
                top: 60px;
                padding: 15px;
            }
            #textInput {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <button id="settingsButton">自定义文字</button>
    <div id="settingsPanel">
        <input type="text" id="textInput" placeholder="请输入烟花文字" maxlength="20" value="2025新年快乐">
        <button id="applyButton">确定</button>
    </div>

    <script>
        // ... [前面的canvas和基础设置代码保持不变] ...

        let customText = "2025新年快乐";
        let audioEnabled = true; // 默认启用音频

        // 设置面板控制
        const settingsButton = document.getElementById('settingsButton');
        const settingsPanel = document.getElementById('settingsPanel');
        const textInput = document.getElementById('textInput');
        const applyButton = document.getElementById('applyButton');

        settingsButton.addEventListener('click', () => {
            settingsPanel.style.display = settingsPanel.style.display === 'none' ? 'block' : 'none';
        });

        applyButton.addEventListener('click', () => {
            customText = textInput.value || "2025新年快乐";
            settingsPanel.style.display = 'none';
        });

        // 点击其他地方关闭设置面板
        document.addEventListener('click', (e) => {
            if (!settingsPanel.contains(e.target) && e.target !== settingsButton) {
                settingsPanel.style.display = 'none';
            }
        });

        // 自动开始放烟花
        window.addEventListener('load', () => {
            // 尝试播放一个静音的音频来解除浏览器的自动播放限制
            const audio = new Audio();
            audio.volume = 0;
            audio.play().catch(() => {});
            
            // 立即开始放烟花
            autoLaunchFirework();
        });

        // ... [其余烟花效果代码保持不变] ...

        // 更新Firework类的explode方法中的文字
        explode() {
            this.alive = false;
            playSound('explosion');
            const color = this.colors[Math.floor(Math.random() * this.colors.length)];

            if (this.isText) {
                const textParticles = getTextParticles(customText, this.x, this.y);
                // ... [其余代码保持不变] ...
            }
            // ... [其余代码保持不变] ...
        }

        // ... [其余动画和渲染代码保持不变] ...
    </script>
</body>
</html>
